<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="UTF-8">
    <title>Mongodbuserstore by asanthamax</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" type="text/css" href="stylesheets/normalize.css" media="screen">
    <link href='https://fonts.googleapis.com/css?family=Open+Sans:400,700' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" type="text/css" href="stylesheets/stylesheet.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/github-light.css" media="screen">
  </head>
  <body>
    <section class="page-header">
      <h1 class="project-name">Mongodbuserstore</h1>
      <h2 class="project-tagline"></h2>
      <a href="https://github.com/asanthamax/mongodbuserstore" class="btn">View on GitHub</a>
      <a href="https://github.com/asanthamax/mongodbuserstore/zipball/master" class="btn">Download .zip</a>
      <a href="https://github.com/asanthamax/mongodbuserstore/tarball/master" class="btn">Download .tar.gz</a>
    </section>

    <section class="main-content">
      <h1>
<a id="mongodbuserstore" class="anchor" href="#mongodbuserstore" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>mongodbuserstore</h1>

<p>First create a Database in MongoDB named wso2_carbon_db 
In mongodb if you create a empty database without a collections it will store it in RAM and not store permanelty therefore create a samle collection using below script</p>

<pre><code>db.system.js.save(
{

 _id: "getNextSequence",

 value : function(name) { 



    var ret = db.COUNTERS.findAndModify(

      {

        query: { _id: name },

        update: { $inc: { seq: 1 } },

        new: true

      }

    );



    return ret.seq;

 }

}

);
db.COUNTERS.insert({

 _id: "UM_DOMAIN",

  seq: 0

});
db.UM_DOMAIN.insert({
  UM_DOMAIN_ID: getNextSequence("UM_DOMAIN"),
  UM_DOMAIN_NAME: "",
  UM_TENANT_ID: 0
});
</code></pre>

<p>here this getNextSequence is to auto_increment id in UM_DOMAIN collection since MongoDB doesn't have auto_increment i implement it using a simple script and COUNTERS is for store the current sequence of collection</p>

<p>after that go to add user store in IS admin console and select MongoDBUserStoreManager from UserStoreManager class dropdown 
then create a new user store with giving appropriate connection configuration</p>

<p>and thats all it will create a new mongodb userstore in Identity Server there after you can do user related activities in IS inside mongodb user store domain since this is development repository you can simply download this and install it using mvn clean install</p>

<p>after successfully built get the jar from target folder and add it with mongo-java-driver you download from above link and get the json lib also from <a href="https://github.com/asanthamax/mongodbuserstore/tree/gh-pages">here</a> and add to deployment folder</p>

<p>If you want IS to default have the MongoDBUserStore you can simply clone product-is repository from here and identity-mongodb-extension from here and first build the mongodb-extension using maven clean install command and after successfully built it build product-is using mvn clean install -Dmaven.test.skip=true command there after it will build a wso-IS zip you can find it inside modules/distributions/target folder get it and unzip and add mongo-java-driver to dropins folder and run the server,you should be able to see MongoDBUserStoreManager in dropdown in create user store UI in admin console this is still not merged to wso2 identity server main repo and mongodb user store manin extension where it will be more likely distributed with IS 5.3.0 until that you can follow one of the process describe in above to deploy mongodbuser store in wso2 identity server</p>

<p>All the documents related to this userstore you can find my repository and below i shared publicaly with google doc also</p> 

<p>[1] <a href="https://docs.google.com/document/d/1mdnmYruzQz5QSxAYwM1XVeJntJMFdxUsV5gord7LuPA/edit?usp=sharing">Admin Guide</a></p>
<p>[2] <a href="https://docs.google.com/document/d/1fCLfZYsPOBkHMzRCGM3aexoBSplX3bKIRmONmFsgkBc/edit?usp=sharing">Developer Guide</a></p>
<p>[3] <a href="http://googledrive.com/host/0B__ZE1ru1jkXbDVoSDlveV9yNk0">Java doc</a></p>
<p>[4] <a href="https://docs.google.com/spreadsheets/d/1jwSR_qFV-LfOS7ZTZ8CpiFFTYPoudDQF7zQhvblivaE/edit?usp=sharing">Committs Spread Sheet</a></p>

<p>And below has the link to my blog which contain all my gsoc2016 experience</p>

<p><a href="http://asanthamax.blogspot.com">http://asanthamax.blogspot.com</a></p> 

      <footer class="site-footer">
        <span class="site-footer-owner"><a href="https://github.com/asanthamax/mongodbuserstore">Mongodbuserstore</a> is maintained by <a href="https://github.com/asanthamax">asanthamax</a>.</span>

        <span class="site-footer-credits">This page was generated by <a href="https://pages.github.com">GitHub Pages</a> using the <a href="https://github.com/jasonlong/cayman-theme">Cayman theme</a> by <a href="https://twitter.com/jasonlong">Jason Long</a>.</span>
      </footer>

    </section>

  
  </body>
</html>
